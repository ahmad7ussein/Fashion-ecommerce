diff --git a/fashion-ecommerce/app/admin/(modules)/home-slider/page.jsx b/fashion-ecommerce/app/admin/(modules)/home-slider/page.jsx
index 224e3b3..ed3c96e 100644
--- a/fashion-ecommerce/app/admin/(modules)/home-slider/page.jsx
+++ b/fashion-ecommerce/app/admin/(modules)/home-slider/page.jsx
@@ -8,6 +8,7 @@ import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/com
 import { Input } from "@/components/ui/input";
 import { Textarea } from "@/components/ui/textarea";
 import { featureControlsApi } from "@/lib/api/featureControls";
+import { sanitizeExternalUrl } from "@/lib/api";
 
 const buildEmptySlide = (order) => ({
   image: "",
@@ -193,7 +194,7 @@ export default function HomeSliderSettingsPage() {
             <Card key={`slide-${index}`} className="overflow-hidden">
               <div className="relative aspect-[4/3] w-full bg-muted">
                 {slide.image ? (
-                  <Image src={slide.image} alt={`Slide ${index + 1}`} fill className="object-cover" />
+                  <Image src={sanitizeExternalUrl(slide.image || "") || "/placeholder-logo.png"} alt={`Slide ${index + 1}`} fill className="object-cover" />
                 ) : (
                   <div className="flex h-full w-full items-center justify-center text-xs text-muted-foreground">
                     No image
@@ -275,7 +276,7 @@ export default function HomeSliderSettingsPage() {
 
             {slides[editingSlideIndex]?.image && (
               <div className="relative h-48 w-full overflow-hidden rounded-lg border border-border md:col-span-2">
-                <Image src={slides[editingSlideIndex].image} alt={`Slide ${editingSlideIndex + 1}`} fill className="object-cover" />
+                <Image src={sanitizeExternalUrl(slides[editingSlideIndex].image || "") || "/placeholder-logo.png"} alt={`Slide ${editingSlideIndex + 1}`} fill className="object-cover" />
               </div>
             )}
 
diff --git a/fashion-ecommerce/app/admin/(modules)/virtual-experience/page.jsx b/fashion-ecommerce/app/admin/(modules)/virtual-experience/page.jsx
index d91b178..2b22f02 100644
--- a/fashion-ecommerce/app/admin/(modules)/virtual-experience/page.jsx
+++ b/fashion-ecommerce/app/admin/(modules)/virtual-experience/page.jsx
@@ -3,6 +3,7 @@ import { useEffect, useMemo, useState } from "react";
 import { featureControlsApi } from "@/lib/api/featureControls";
 import { productsAdminApi } from "@/lib/api/productsAdmin";
 import { useAuth } from "@/lib/auth";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
 import { Button } from "@/components/ui/button";
 import { Input } from "@/components/ui/input";
@@ -121,7 +122,7 @@ export default function VirtualExperienceControlPage() {
                 No products added yet.
               </div>)}
             {supportedProducts.map((product) => {
-            const imageUrl = product.image || product.images?.[0] || "/placeholder-logo.png";
+            const imageUrl = sanitizeExternalUrl(product.image || product.images?.[0] || "") || "/placeholder-logo.png";
             return (<Card key={product._id || product.id} className="overflow-hidden">
                   <div className="relative aspect-[4/3] w-full bg-muted">
                     <img src={imageUrl} alt={product.name || "Product"} className="h-full w-full object-cover"/>
diff --git a/fashion-ecommerce/app/admin/page.jsx b/fashion-ecommerce/app/admin/page.jsx
index c8f94be..47e7e38 100644
--- a/fashion-ecommerce/app/admin/page.jsx
+++ b/fashion-ecommerce/app/admin/page.jsx
@@ -25,9 +25,9 @@ import { getContactMessages, updateContactMessage, deleteContactMessage } from "
 import { useToast } from "@/hooks/use-toast";
 import { useTheme } from "next-themes";
 import { useLanguage } from "@/lib/language";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { t } from "@/lib/i18n";
-import { AdminSidebar } from "@/components/admin/AdminSidebar";
-import { AdminTopbar } from "@/components/admin/AdminTopbar";
+import { AdminLayout } from "@/components/admin/AdminLayout";
 import { StaffChatWidget } from "@/components/staff-chat-widget";
 import { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, } from "recharts";
 const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];
@@ -57,6 +57,17 @@ const COLOR_OPTIONS = [
 const COLOR_OPTION_MAP = new Map(COLOR_OPTIONS.map((option) => [option.id, option]));
 const normalizeColorKey = (value) => value.trim().toLowerCase();
 const parseColorList = (value) => value.split(",").map((color) => color.trim()).filter(Boolean);
+const resolveImageUrl = (value) => {
+    if (!value)
+        return "";
+    if (typeof value === "string")
+        return sanitizeExternalUrl(value);
+    if (value && typeof value === "object") {
+        const candidate = value.url || value.secure_url || value.path;
+        return typeof candidate === "string" ? sanitizeExternalUrl(candidate) : "";
+    }
+    return "";
+};
 const getColorLabel = (colorId, language) => {
     const option = COLOR_OPTION_MAP.get(normalizeColorKey(colorId));
     if (!option)
@@ -1311,17 +1322,10 @@ function AdminDashboardContent() {
     const previewSideData = designPreviewItem?.designMetadata?.studio?.data?.designBySide?.[designPreviewSide] || {};
     const previewArea = resolvePreviewArea(previewProduct, designPreviewSide);
     const previewBaseImage = resolvePreviewBaseImage(designPreviewItem, previewProduct, designPreviewSide);
-    return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20">
-      <div className="flex min-h-screen">
-        <aside className="w-64 h-screen sticky top-0 shrink-0 border-r border-border/50 bg-gradient-to-b from-background via-background to-muted/30">
-          <AdminSidebar activeTab={activeTab} pendingReviewsCount={reviews.filter((r) => r.status === "pending").length}/>
-        </aside>
-        <div className="flex-1 min-w-0">
-          <div className="sticky top-0 z-40 border-b border-border/60 bg-background/90 backdrop-blur">
-            <AdminTopbar />
-          </div>
-          <div className="p-4 lg:p-8 animate-in fade-in duration-500">
-        {loading ? (<div className="flex items-center justify-center h-screen">
+    return (<>
+      <AdminLayout activeTab={activeTab} pendingReviewsCount={reviews.filter((r) => r.status === "pending").length}>
+        <div className="animate-in fade-in duration-500">
+        {loading ? (<div className="flex items-center justify-center min-h-[60vh]">
             <AppLoader label="Loading dashboard..." size="lg"/>
           </div>) : (<>
         
@@ -1702,7 +1706,7 @@ function AdminDashboardContent() {
                                   <TableCell className="font-medium">
                                     <div className="flex items-center gap-3">
                                       <div className="relative w-12 h-12 sm:w-16 sm:h-16 rounded-lg overflow-hidden border-2 border-gray-200 flex-shrink-0">
-                                        <Image src={product.image || "/placeholder-logo.png"} alt={product.name || "Product"} fill className="object-cover" sizes="64px" loading="lazy" quality={75} onError={(e) => {
+                                        <Image src={sanitizeExternalUrl(product.image || "") || "/placeholder-logo.png"} alt={product.name || "Product"} fill className="object-cover" sizes="64px" loading="lazy" quality={75} onError={(e) => {
                                     const target = e.target;
                                     if (target.src !== "/placeholder-logo.png") {
                                         target.src = "/placeholder-logo.png";
@@ -1894,7 +1898,7 @@ function AdminDashboardContent() {
                       <input id="main-image" type="file" accept="image/*" onChange={handleMainImageUpload} className="hidden"/>
                       {productForm.image && (<div className="mt-4 relative w-full max-w-xs mx-auto">
                           <div className="relative aspect-square rounded-lg overflow-hidden border-2 border-primary">
-                            <img src={productForm.image} alt={language === "ar" ? "معاينة الصورة الرئيسية" : "Main image preview"} className="w-full h-full object-cover"/>
+                            <img src={sanitizeExternalUrl(productForm.image || "")} alt={language === "ar" ? "معاينة الصورة الرئيسية" : "Main image preview"} className="w-full h-full object-cover"/>
                           </div>
                           <Button type="button" variant="destructive" size="icon" className="absolute top-2 right-2" onClick={() => {
                         setProductForm({ ...productForm, image: "" });
@@ -1938,7 +1942,7 @@ function AdminDashboardContent() {
                       {productForm.images.length > 0 && (<div className="mt-4 grid grid-cols-3 gap-4">
                           {Array.from({ length: 3 }).map((_, index) => (<div key={index} className="relative aspect-square rounded-lg overflow-hidden border-2 border-border">
                               {productForm.images[index] ? (<>
-                                  <img src={productForm.images[index]} alt={language === "ar" ? `صورة إضافية ${index + 1}` : `Additional image ${index + 1}`} className="w-full h-full object-cover"/>
+                                  <img src={sanitizeExternalUrl(productForm.images[index] || "")} alt={language === "ar" ? `صورة إضافية ${index + 1}` : `Additional image ${index + 1}`} className="w-full h-full object-cover"/>
                                   <Button type="button" variant="destructive" size="icon" className="absolute top-2 right-2" onClick={() => removeAdditionalImage(index)}>
                                     <X className="h-4 w-4"/>
                                   </Button>
@@ -2286,7 +2290,11 @@ function AdminDashboardContent() {
             const colorMockups = p.colorMockups || {};
             const firstColorView = Object.values(colorViews)[0];
             const firstColorMockup = Object.values(colorMockups)[0];
-            const thumbnailUrl = p.viewMockups?.front || p.baseMockupUrl || firstColorView?.front || firstColorMockup || "/placeholder-logo.png";
+            const thumbnailUrl = resolveImageUrl(p.viewMockups?.front)
+                || resolveImageUrl(p.baseMockupUrl)
+                || resolveImageUrl(firstColorView?.front)
+                || resolveImageUrl(firstColorMockup)
+                || "/placeholder-logo.png";
             return (<TableRow key={p._id}>
                           <TableCell className="font-medium">
                             <div className="flex items-center gap-3">
@@ -2296,6 +2304,12 @@ function AdminDashboardContent() {
                                   alt={p.name}
                                   className="h-full w-full object-cover"
                                   loading="lazy"
+                                  onError={(e) => {
+                    if (e.currentTarget.dataset.fallbackApplied)
+                        return;
+                    e.currentTarget.dataset.fallbackApplied = "true";
+                    e.currentTarget.src = "/placeholder-logo.png";
+                }}
                                 />
                               </div>
                               <span>{p.name}</span>
@@ -3494,7 +3508,7 @@ function AdminDashboardContent() {
                   <Label className="text-sm font-medium mb-2 block">{language === "ar" ? "المنتجات" : "Items"}</Label>
                   <div className="space-y-2">
                     {selectedOrder.items.map((item, index) => (<div key={index} className="flex items-center gap-4 p-3 border rounded">
-                        <img src={item.image} alt={item.name} className="w-16 h-16 object-cover rounded"/>
+                        <img src={sanitizeExternalUrl(item.image || "")} alt={item.name} className="w-16 h-16 object-cover rounded"/>
                         <div className="flex-1">
                           <p className="font-medium">{item.name}</p>
                           <p className="text-sm text-muted-foreground">
@@ -3594,7 +3608,7 @@ function AdminDashboardContent() {
                 </div>
                 <div className="relative overflow-hidden rounded-2xl border border-rose-200 bg-white shadow-sm">
                   <div className="relative aspect-[4/5]">
-                    {previewBaseImage ? (<img src={previewBaseImage} alt={designPreviewItem.name} className="h-full w-full object-contain"/>) : (<div className="flex h-full w-full items-center justify-center text-sm text-muted-foreground">
+                    {previewBaseImage ? (<img src={sanitizeExternalUrl(previewBaseImage || "")} alt={designPreviewItem.name} className="h-full w-full object-contain"/>) : (<div className="flex h-full w-full items-center justify-center text-sm text-muted-foreground">
                         {language === "ar" ? "لا توجد معاينة" : "No preview available"}
                       </div>)}
                     <div className="absolute" style={previewArea}>
@@ -3608,7 +3622,7 @@ function AdminDashboardContent() {
                     maxWidth: "100%",
                     maxHeight: "100%",
                 }}>
-                            <img src={previewSideData.uploadedImage} alt="Design asset" className="h-full w-full object-contain"/>
+                            <img src={sanitizeExternalUrl(previewSideData.uploadedImage || "")} alt="Design asset" className="h-full w-full object-contain"/>
                           </div>
                         </div>)}
                       {previewSideData?.textValue && (<div className="absolute inset-0 flex items-center justify-center p-2">
@@ -3718,10 +3732,9 @@ function AdminDashboardContent() {
           </DialogContent>
         </Dialog>
           </div>
-        </div>
-      </div>
+        </AdminLayout>
       <StaffChatWidget mode="admin" />
-    </div>);
+    </>);
 }
 
 export default function AdminDashboard() {
diff --git a/fashion-ecommerce/app/cart/page.jsx b/fashion-ecommerce/app/cart/page.jsx
index fc6e309..81204b3 100644
--- a/fashion-ecommerce/app/cart/page.jsx
+++ b/fashion-ecommerce/app/cart/page.jsx
@@ -9,6 +9,7 @@ import { Input } from "@/components/ui/input";
 import { ShoppingBag, Minus, Plus, Trash2, ArrowRight, Tag } from "lucide-react";
 import { useCart } from "@/lib/cart";
 import { useRegion } from "@/lib/region";
+import { sanitizeExternalUrl } from "@/lib/api";
 export default function CartPage() {
     const { items: cartItems, updateQuantity, removeItem, subtotal } = useCart();
     const { formatPrice, convertPrice } = useRegion();
@@ -16,7 +17,7 @@ export default function CartPage() {
     const shipping = subtotal > 100 ? 0 : 9.99;
     const tax = subtotal * 0.08;
     const total = subtotal + shipping + tax;
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
       <div className="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-24 py-6 sm:py-8 md:py-12">
         <motion.h1 initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} className="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-6 sm:mb-8 md:mb-12 text-gray-900">
           Shopping <span className="bg-gradient-to-r from-rose-500 via-pink-500 to-rose-600 bg-clip-text text-transparent">Cart</span>
@@ -40,7 +41,7 @@ export default function CartPage() {
                     <CardContent className="p-4 sm:p-5 md:p-6">
                       <div className="flex flex-col sm:flex-row gap-4 sm:gap-6">
                         <div className="w-full sm:w-24 md:w-32 h-48 sm:h-24 md:h-32 rounded-xl overflow-hidden bg-gradient-to-br from-rose-50 to-pink-50 flex-shrink-0 relative">
-                          <Image src={item.image || "/placeholder-logo.png"} alt={item.name} fill className="object-cover" sizes="(max-width: 640px) 100vw, 128px"/>
+                          <Image src={sanitizeExternalUrl(item.image || "") || "/placeholder-logo.png"} alt={item.name} fill className="object-cover" sizes="(max-width: 640px) 100vw, 128px"/>
                         </div>
 
                         <div className="flex-1">
diff --git a/fashion-ecommerce/app/checkout/page.jsx b/fashion-ecommerce/app/checkout/page.jsx
index 979d58a..12c3651 100644
--- a/fashion-ecommerce/app/checkout/page.jsx
+++ b/fashion-ecommerce/app/checkout/page.jsx
@@ -15,6 +15,7 @@ import { useRegion } from "@/lib/region";
 import { ordersApi } from "@/lib/api/orders";
 import { designsApi } from "@/lib/api/designs";
 import { paymentsApi } from "@/lib/api/payments";
+import { sanitizeExternalUrl } from "@/lib/api";
 import logger from "@/lib/logger";
 import { useForm } from "react-hook-form";
 import { z } from "zod";
@@ -172,10 +173,10 @@ export default function CheckoutPage() {
             setIsSubmitting(false);
         }
     };
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-24">
-      <div className="container mx-auto px-6 md:px-12 lg:px-24 py-12">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
+      <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-10 md:py-12">
         <div className="max-w-6xl mx-auto">
-          <motion.h1 initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} className="text-5xl md:text-6xl font-bold mb-12 text-gray-900">
+          <motion.h1 initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} className="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-8 sm:mb-10 md:mb-12 text-gray-900">
             Checkout
           </motion.h1>
 
@@ -192,7 +193,7 @@ export default function CheckoutPage() {
                     </CardTitle>
                   </CardHeader>
                   <CardContent className="space-y-4">
-                    <div className="grid grid-cols-2 gap-4">
+                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                       <div>
                         <Label htmlFor="firstName">First Name</Label>
                         <Input id="firstName" {...form.register("firstName")}/>
@@ -218,7 +219,7 @@ export default function CheckoutPage() {
                       <Input id="address" {...form.register("address")}/>
                     </div>
 
-                    <div className="grid grid-cols-2 gap-4">
+                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                       <div>
                         <Label htmlFor="city">City</Label>
                         <Input id="city" {...form.register("city")}/>
@@ -229,7 +230,7 @@ export default function CheckoutPage() {
                       </div>
                     </div>
 
-                    <div className="grid grid-cols-2 gap-4">
+                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                       <div>
                         <Label htmlFor="zip">ZIP Code</Label>
                         <Input id="zip" {...form.register("zip")}/>
@@ -255,7 +256,7 @@ export default function CheckoutPage() {
                     <div className="space-y-3 max-h-[400px] overflow-y-auto">
                       {items.map((item) => (<div key={item.id} className="flex gap-3 pb-3 border-b border-border">
                           <div className="w-16 h-16 rounded bg-muted flex-shrink-0 overflow-hidden relative">
-                            <Image src={item.image || "/placeholder-logo.png"} alt={item.name} fill className="object-cover" sizes="64px"/>
+                            <Image src={sanitizeExternalUrl(item.image || "") || "/placeholder-logo.png"} alt={item.name} fill className="object-cover" sizes="64px"/>
                         </div>
                         <div className="flex-1">
                             <p className="text-sm font-medium">{item.name}</p>
diff --git a/fashion-ecommerce/app/collection/page.jsx b/fashion-ecommerce/app/collection/page.jsx
index 396f8ad..c31ab8c 100644
--- a/fashion-ecommerce/app/collection/page.jsx
+++ b/fashion-ecommerce/app/collection/page.jsx
@@ -15,6 +15,7 @@ import { useAuth } from "@/lib/auth";
 import { useToast } from "@/hooks/use-toast";
 import { favoritesApi } from "@/lib/api/favorites";
 import { useCart } from "@/lib/cart";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { useRouter } from "next/navigation";
 import { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious, } from "@/components/ui/carousel";
 export default function CollectionPage() {
@@ -235,7 +236,7 @@ export default function CollectionPage() {
           <Link href={`/products/${productId}`}>
             <Card className="group overflow-hidden bg-white backdrop-blur-sm border-2 border-gray-200 hover:bg-white hover:border-rose-300 hover:shadow-xl transition-all duration-300 rounded-xl sm:rounded-2xl cursor-pointer h-full flex flex-col">
               <div className="aspect-square overflow-hidden bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                <Image src={product.image || "/placeholder-logo.png"} alt={product.name} width={300} height={300} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/>
+                <Image src={sanitizeExternalUrl(product.image || "") || "/placeholder-logo.png"} alt={product.name} width={300} height={300} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/>
                 <div className="absolute inset-0 bg-gradient-to-t from-white/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"/>
                 <div className="absolute top-2 left-2 sm:top-3 sm:left-3 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-all duration-300">
                   <Badge className="text-xs sm:text-sm bg-rose-500 text-white border-0 rounded-full px-2 sm:px-3 py-1">
@@ -288,7 +289,7 @@ export default function CollectionPage() {
         </div>
       </motion.div>);
     };
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
       <div className="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-24 py-6 sm:py-8 md:py-12">
         
         <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8 sm:mb-12">
diff --git a/fashion-ecommerce/app/collections/page.jsx b/fashion-ecommerce/app/collections/page.jsx
index 23ef527..0844d7f 100644
--- a/fashion-ecommerce/app/collections/page.jsx
+++ b/fashion-ecommerce/app/collections/page.jsx
@@ -15,6 +15,7 @@ import { useAuth } from "@/lib/auth";
 import { useToast } from "@/hooks/use-toast";
 import { favoritesApi } from "@/lib/api/favorites";
 import { useCart } from "@/lib/cart";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { useRouter } from "next/navigation";
 export default function CollectionsPage() {
     const { formatPrice } = useRegion();
@@ -264,14 +265,14 @@ export default function CollectionsPage() {
     }, {});
     const categories = Object.keys(groupedProducts);
     if (isLoading) {
-        return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
+        return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
         <div className="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 py-12">
           <ProductGridSkeleton count={12}/>
         </div>
       </div>);
     }
     if (products.length === 0) {
-        return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24 flex items-center justify-center">
+        return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24 flex items-center justify-center">
         <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center max-w-md mx-auto px-4">
           <Star className="h-16 w-16 text-rose-300 mx-auto mb-4"/>
           <h2 className="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">
@@ -290,10 +291,10 @@ export default function CollectionsPage() {
         </motion.div>
       </div>);
     }
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
       
-      <section className="relative overflow-hidden min-h-screen flex items-center">
-        <div className="relative w-full h-screen" onMouseEnter={() => setIsPaused(true)} onMouseLeave={() => setIsPaused(false)} onTouchStart={() => setIsPaused(true)} onTouchEnd={() => setIsPaused(false)}>
+      <section className="relative overflow-hidden min-h-[100svh] flex items-center">
+        <div className="relative w-full h-[100svh]" onMouseEnter={() => setIsPaused(true)} onMouseLeave={() => setIsPaused(false)} onTouchStart={() => setIsPaused(true)} onTouchEnd={() => setIsPaused(false)}>
           <AnimatePresence mode="sync" initial={false} custom={slideDirection}>
             {heroSlides.length > 0 && (<motion.div key={currentSlide} custom={slideDirection} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.9, ease: [0.22, 1, 0.36, 1] }} className="absolute inset-0 flex items-center overflow-hidden" style={{ background: "linear-gradient(135deg, #fdeef4 0%, #fff6fb 45%, #fde0ea 100%)" }}>
                 
@@ -355,7 +356,7 @@ export default function CollectionsPage() {
                           <div className="absolute top-4 right-4 w-20 h-20 bg-gradient-to-br from-rose-200/30 to-pink-200/30 rounded-full blur-2xl"/>
                           <div className="absolute bottom-4 left-4 w-16 h-16 bg-gradient-to-br from-pink-200/30 to-rose-200/30 rounded-full blur-xl"/>
                           <div className="relative w-full h-full min-h-[320px] sm:min-h-[420px] lg:min-h-[520px]">
-                            <Image src={heroSlides[currentSlide].image || "/placeholder-logo.png"} alt={heroSlides[currentSlide].name} fill className="object-contain rounded-2xl" priority={currentSlide === 0} sizes="(max-width: 768px) 100vw, 50vw"/>
+                            <Image src={sanitizeExternalUrl(heroSlides[currentSlide].image || "") || "/placeholder-logo.png"} alt={heroSlides[currentSlide].name} fill className="object-contain rounded-2xl" priority={currentSlide === 0} sizes="(max-width: 768px) 100vw, 50vw"/>
                           </div>
                         </motion.div>
                       </div>
@@ -370,15 +371,15 @@ export default function CollectionsPage() {
             e.stopPropagation();
             setSlideDirection(-1);
             setCurrentSlide((prev) => (prev - 1 + heroSlides.length) % heroSlides.length);
-        }} className="absolute left-4 top-1/2 -translate-y-1/2 z-40 bg-white/90 hover:bg-white backdrop-blur-sm rounded-full p-3 shadow-lg border border-rose-200 transition-all duration-300 hover:scale-110 group" aria-label="Previous slide" disabled={heroSlides.length === 0}>
-            <ChevronLeft className="h-6 w-6 text-gray-700 group-hover:text-rose-600 transition-colors"/>
+        }} className="absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 z-40 bg-white/90 hover:bg-white backdrop-blur-sm rounded-full p-2 sm:p-3 shadow-lg border border-rose-200 transition-all duration-300 hover:scale-110 group" aria-label="Previous slide" disabled={heroSlides.length === 0}>
+            <ChevronLeft className="h-5 w-5 sm:h-6 sm:w-6 text-gray-700 group-hover:text-rose-600 transition-colors"/>
           </button>
           <button onClick={(e) => {
             e.stopPropagation();
             setSlideDirection(1);
             setCurrentSlide((prev) => (prev + 1) % heroSlides.length);
-        }} className="absolute right-4 top-1/2 -translate-y-1/2 z-40 bg-white/90 hover:bg-white backdrop-blur-sm rounded-full p-3 shadow-lg border border-rose-200 transition-all duration-300 hover:scale-110 group" aria-label="Next slide" disabled={heroSlides.length === 0}>
-            <ChevronRight className="h-6 w-6 text-gray-700 group-hover:text-rose-600 transition-colors"/>
+        }} className="absolute right-3 sm:right-4 top-1/2 -translate-y-1/2 z-40 bg-white/90 hover:bg-white backdrop-blur-sm rounded-full p-2 sm:p-3 shadow-lg border border-rose-200 transition-all duration-300 hover:scale-110 group" aria-label="Next slide" disabled={heroSlides.length === 0}>
+            <ChevronRight className="h-5 w-5 sm:h-6 sm:w-6 text-gray-700 group-hover:text-rose-600 transition-colors"/>
           </button>
 
           
@@ -438,7 +439,7 @@ export default function CollectionsPage() {
                         <Card className="overflow-hidden bg-white border-2 border-gray-200 hover:border-rose-300 hover:shadow-2xl transition-all duration-500 rounded-2xl h-full flex flex-col relative">
                           
                           <div className="aspect-square overflow-hidden bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                            <Image src={product.image || "/placeholder-logo.png"} alt={product.name} fill className="object-cover group-hover:scale-110 transition-transform duration-700" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"/>
+                            <Image src={sanitizeExternalUrl(product.image || "") || "/placeholder-logo.png"} alt={product.name} fill className="object-cover group-hover:scale-110 transition-transform duration-700" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"/>
                             
                             
                             <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"/>
diff --git a/fashion-ecommerce/app/employee/page.jsx b/fashion-ecommerce/app/employee/page.jsx
index 8331fe5..acec07b 100644
--- a/fashion-ecommerce/app/employee/page.jsx
+++ b/fashion-ecommerce/app/employee/page.jsx
@@ -22,6 +22,7 @@ import { studioProductsApi } from "@/lib/api/studioProducts";
 import { useToast } from "@/hooks/use-toast";
 import { useTheme } from "next-themes";
 import { useLanguage } from "@/lib/language";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { t } from "@/lib/i18n";
 import { Trash2, Plus, Upload, X, Check } from "lucide-react";
 import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog";
@@ -30,6 +31,7 @@ import Image from "next/image";
 import { AppLoader } from "@/components/ui/app-loader";
 import { StaffChatPanel } from "@/components/staff-chat-panel";
 import { StaffChatWidget } from "@/components/staff-chat-widget";
+import { EmployeeLayout } from "@/components/employee/EmployeeLayout";
 import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger, } from "@/components/ui/dropdown-menu";
 import { getNotifications, markAllAsRead } from "@/lib/api/notifications";
 import { staffChatApi } from "@/lib/api/staffChat";
@@ -74,6 +76,17 @@ const COLOR_OPTIONS = [
 ];
 const normalizeColorKey = (value) => value.trim().toLowerCase();
 const parseColorList = (value) => value.split(",").map((color) => color.trim()).filter(Boolean);
+const resolveImageUrl = (value) => {
+    if (!value)
+        return "";
+    if (typeof value === "string")
+        return sanitizeExternalUrl(value);
+    if (value && typeof value === "object") {
+        const candidate = value.url || value.secure_url || value.path;
+        return typeof candidate === "string" ? sanitizeExternalUrl(candidate) : "";
+    }
+    return "";
+};
 export default function EmployeeDashboard() {
     const [activeTab, setActiveTab] = useState("overview");
     const [orders, setOrders] = useState([]);
@@ -896,9 +909,7 @@ export default function EmployeeDashboard() {
     const previewSideData = designPreviewItem?.designMetadata?.studio?.data?.designBySide?.[designPreviewSide] || {};
     const previewArea = resolvePreviewArea(previewProduct, designPreviewSide);
     const previewBaseImage = resolvePreviewBaseImage(designPreviewItem, previewProduct, designPreviewSide);
-    return (<div className="min-h-screen bg-muted/30">
-      
-      <div className="fixed left-0 top-0 h-full w-64 bg-background border-r border-border overflow-y-auto z-50">
+    const sidebarContent = (<div className="flex h-full flex-col overflow-y-auto">
         <div className="p-6">
           <Link href="/">
             <Logo className="h-20 w-auto"/>
@@ -930,7 +941,7 @@ export default function EmployeeDashboard() {
 
           <button onClick={() => setActiveTab("progress")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === "progress" ? "bg-blue-800 text-white border border-blue-900" : "hover:bg-muted"}`}>
             <Printer className="h-5 w-5"/>
-            <span className="font-medium">{language === "ar" ? "تتبع التقدم" : "Progress Tracking"}</span>
+            <span className="font-medium">{language === "ar" ? 'O?O?O"1 O‎O‎O‎,‎O‎,‎O‎.' : "Progress Tracking"}</span>
           </button>
 
           <button onClick={() => setActiveTab("products")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === "products" ? "bg-blue-800 text-white border border-blue-900" : "hover:bg-muted"}`}>
@@ -940,7 +951,7 @@ export default function EmployeeDashboard() {
 
           <button onClick={() => setActiveTab("studioProducts")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === "studioProducts" ? "bg-blue-800 text-white border border-blue-900" : "hover:bg-muted"}`}>
             <PackageCheck className="h-5 w-5"/>
-            <span className="font-medium">{language === "ar" ? "منتجات الاستديو" : "Studio Products"}</span>
+            <span className="font-medium">{language === "ar" ? "U.U+O?O?O‎‎O? O‎,‎O‎3O?O_USU^" : "Studio Products"}</span>
           </button>
 
           <button onClick={() => setActiveTab("customers")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === "customers" ? "bg-blue-800 text-white border border-blue-900" : "hover:bg-muted"}`}>
@@ -954,7 +965,7 @@ export default function EmployeeDashboard() {
           </button>
         </nav>
 
-        <div className="absolute bottom-6 left-4 right-4 space-y-2">
+        <div className="mt-auto space-y-2 px-4 pb-6">
           <div className="flex gap-2">
             <Button variant="outline" size="icon" onClick={() => setTheme(theme === "dark" ? "light" : "dark")} className="flex-1">
               {theme === "dark" ? <Sun className="h-4 w-4"/> : <Moon className="h-4 w-4"/>}
@@ -967,21 +978,20 @@ export default function EmployeeDashboard() {
             window.open("/", "_blank");
         }}>
             <Eye className="h-4 w-4 mr-2"/>
-            {language === "ar" ? "عرض كزائر" : "View as Guest"}
+            {language === "ar" ? "O1O?O‎ U?O?O‎O?O?" : "View as Guest"}
           </Button>
           <Link href="/">
             <Button variant="outline" className="w-full bg-transparent">
-              {language === "ar" ? "العودة للمتجر" : "Back to Store"}
+              {language === "ar" ? "O‎,‎O1U^O‎_Oc U,U,U.O?O?O?" : "Back to Store"}
             </Button>
           </Link>
           <Button variant="outline" className="w-full bg-transparent" onClick={logout}>
             {t("logout", language)}
           </Button>
         </div>
-      </div>
-
-      
-      <div className="ml-64 p-8">
+        </div>);
+    return (<EmployeeLayout sidebar={sidebarContent} title={language === "ar" ? "لوحة الموظف" : "Employee Dashboard"}>
+      <div className="p-4 sm:p-6 lg:p-8">
         <div className="flex items-center justify-end gap-2 mb-6">
           <DropdownMenu open={notificationsOpen} onOpenChange={setNotificationsOpen}>
             <DropdownMenuTrigger asChild>
@@ -1160,7 +1170,11 @@ export default function EmployeeDashboard() {
             const colorMockups = p.colorMockups || {};
             const firstColorView = Object.values(colorViews)[0];
             const firstColorMockup = Object.values(colorMockups)[0];
-            const thumbnailUrl = p.viewMockups?.front || p.baseMockupUrl || firstColorView?.front || firstColorMockup || "/placeholder-logo.png";
+            const thumbnailUrl = resolveImageUrl(p.viewMockups?.front)
+                || resolveImageUrl(p.baseMockupUrl)
+                || resolveImageUrl(firstColorView?.front)
+                || resolveImageUrl(firstColorMockup)
+                || "/placeholder-logo.png";
             return (<TableRow key={p._id}>
                           <TableCell className="font-medium">
                             <div className="flex items-center gap-3">
@@ -1170,6 +1184,12 @@ export default function EmployeeDashboard() {
                                   alt={p.name}
                                   className="h-full w-full object-cover"
                                   loading="lazy"
+                                  onError={(e) => {
+                    if (e.currentTarget.dataset.fallbackApplied)
+                        return;
+                    e.currentTarget.dataset.fallbackApplied = "true";
+                    e.currentTarget.src = "/placeholder-logo.png";
+                }}
                                 />
                               </div>
                               <span>{p.name}</span>
@@ -1219,8 +1239,8 @@ export default function EmployeeDashboard() {
                     <Label>View Mockups (Front / Back)</Label>
                     <div className="space-y-3">
                       {["front", "back"].map((viewKey) => {
-            const previewUrl = studioForm.viewMockups?.[viewKey] || (viewKey === "front" ? studioForm.baseMockupUrl : "");
-            return (<div key={viewKey} className="border-2 border-dashed border-border rounded-lg p-3 hover:border-primary transition-colors">
+                        const previewUrl = studioForm.viewMockups?.[viewKey] || (viewKey === "front" ? studioForm.baseMockupUrl : "");
+                        return (<div key={viewKey} className="border-2 border-dashed border-border rounded-lg p-3 hover:border-primary transition-colors">
                             <div className="flex items-center justify-between gap-2">
                               <span className="text-sm font-medium capitalize">{viewKey}</span>
                               <div className="flex items-center gap-2">
@@ -1243,8 +1263,8 @@ export default function EmployeeDashboard() {
                                   <X className="h-4 w-4"/>
                                 </Button>
                               </div>)}
-                          </div>);
-        })}
+                            </div>);
+                      })}
                     </div>
                     <Label>Price</Label>
                     <Input type="number" value={studioForm.price} onChange={(e) => setStudioForm({ ...studioForm, price: e.target.value })}/>
@@ -1731,7 +1751,7 @@ export default function EmployeeDashboard() {
                                   <TableCell className="font-medium">
                                     <div className="flex items-center gap-3">
                                       <div className="relative w-12 h-12 sm:w-16 sm:h-16 rounded-lg overflow-hidden border-2 border-gray-200 flex-shrink-0">
-                                        <Image src={product.image || "/placeholder-logo.png"} alt={product.name || "Product"} fill className="object-cover" sizes="64px" onError={(e) => {
+                                        <Image src={sanitizeExternalUrl(product.image || "") || "/placeholder-logo.png"} alt={product.name || "Product"} fill className="object-cover" sizes="64px" onError={(e) => {
                                     const target = e.target;
                                     if (target.src !== "/placeholder-logo.png") {
                                         target.src = "/placeholder-logo.png";
@@ -1895,7 +1915,7 @@ export default function EmployeeDashboard() {
                       <input id="main-image" type="file" accept="image/*" onChange={handleMainImageUpload} className="hidden"/>
                       {productForm.image && (<div className="mt-4 relative w-full max-w-xs mx-auto">
                           <div className="relative aspect-square rounded-lg overflow-hidden border-2 border-primary">
-                            <img src={productForm.image} alt={language === "ar" ? "معاينة الصورة الرئيسية" : "Main image preview"} className="w-full h-full object-cover"/>
+                            <img src={sanitizeExternalUrl(productForm.image || "")} alt={language === "ar" ? "معاينة الصورة الرئيسية" : "Main image preview"} className="w-full h-full object-cover"/>
                           </div>
                           <Button type="button" variant="destructive" size="icon" className="absolute top-2 right-2" onClick={() => {
                         setProductForm({ ...productForm, image: "" });
@@ -1939,7 +1959,7 @@ export default function EmployeeDashboard() {
                       {productForm.images.length > 0 && (<div className="mt-4 grid grid-cols-3 gap-4">
                           {Array.from({ length: 3 }).map((_, index) => (<div key={index} className="relative aspect-square rounded-lg overflow-hidden border-2 border-border">
                               {productForm.images[index] ? (<>
-                                  <img src={productForm.images[index]} alt={language === "ar" ? `صورة إضافية ${index + 1}` : `Additional image ${index + 1}`} className="w-full h-full object-cover"/>
+                                  <img src={sanitizeExternalUrl(productForm.images[index] || "")} alt={language === "ar" ? `صورة إضافية ${index + 1}` : `Additional image ${index + 1}`} className="w-full h-full object-cover"/>
                                   <Button type="button" variant="destructive" size="icon" className="absolute top-2 right-2" onClick={() => removeAdditionalImage(index)}>
                                     <X className="h-4 w-4"/>
                                   </Button>
@@ -2319,7 +2339,7 @@ export default function EmployeeDashboard() {
                     </Label>
                     <div className="space-y-2">
                       {selectedOrder.items.map((item, index) => (<div key={`${item._id || item.name}-${index}`} className="flex items-center gap-4 p-3 border rounded">
-                          <img src={item.image} alt={item.name} className="w-12 h-12 object-cover rounded"/>
+                          <img src={sanitizeExternalUrl(item.image || "")} alt={item.name} className="w-12 h-12 object-cover rounded"/>
                           <div className="flex-1">
                             <p className="font-medium">{item.name}</p>
                             <p className="text-xs text-muted-foreground">
@@ -2436,7 +2456,7 @@ export default function EmployeeDashboard() {
               </div>
               <div className="relative overflow-hidden rounded-2xl border border-rose-200 bg-white shadow-sm">
                 <div className="relative aspect-[4/5]">
-                  {previewBaseImage ? (<img src={previewBaseImage} alt={designPreviewItem.name} className="h-full w-full object-contain"/>) : (<div className="flex h-full w-full items-center justify-center text-sm text-muted-foreground">
+                  {previewBaseImage ? (<img src={sanitizeExternalUrl(previewBaseImage || "")} alt={designPreviewItem.name} className="h-full w-full object-contain"/>) : (<div className="flex h-full w-full items-center justify-center text-sm text-muted-foreground">
                       {language === "ar" ? "لا توجد معاينة" : "No preview available"}
                     </div>)}
                   <div className="absolute" style={previewArea}>
@@ -2450,7 +2470,7 @@ export default function EmployeeDashboard() {
                     maxWidth: "100%",
                     maxHeight: "100%",
                 }}>
-                          <img src={previewSideData.uploadedImage} alt="Design asset" className="h-full w-full object-contain"/>
+                          <img src={sanitizeExternalUrl(previewSideData.uploadedImage || "")} alt="Design asset" className="h-full w-full object-contain"/>
                         </div>
                       </div>)}
                     {previewSideData?.textValue && (<div className="absolute inset-0 flex items-center justify-center p-2">
@@ -2472,5 +2492,5 @@ export default function EmployeeDashboard() {
       </Dialog>
       </div>
       <StaffChatWidget mode="employee" />
-    </div>);
+    </EmployeeLayout>);
 }
diff --git a/fashion-ecommerce/app/forgot-password/page.jsx b/fashion-ecommerce/app/forgot-password/page.jsx
index 584cbc6..cd8e035 100644
--- a/fashion-ecommerce/app/forgot-password/page.jsx
+++ b/fashion-ecommerce/app/forgot-password/page.jsx
@@ -9,6 +9,7 @@ import { useToast } from "@/hooks/use-toast";
 import { Logo } from "@/components/logo";
 import { Mail, Loader2, ArrowLeft, CheckCircle2 } from "lucide-react";
 import logger from "@/lib/logger";
+import { API_BASE_URL } from "@/lib/api";
 export default function ForgotPasswordPage() {
     const [email, setEmail] = useState("");
     const [isLoading, setIsLoading] = useState(false);
@@ -35,8 +36,7 @@ export default function ForgotPasswordPage() {
         setIsLoading(true);
         logger.log("Requesting password reset for:", email);
         try {
-            const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
-            const response = await fetch(`${API_BASE_URL}/auth/forgot-password`, {
+            const response = await fetch(`${API_BASE_URL()}/auth/forgot-password`, {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
@@ -71,7 +71,7 @@ export default function ForgotPasswordPage() {
         }
     };
     if (isSuccess) {
-        return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
+        return (<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
         <div className="w-full max-w-md">
           <Card className="shadow-lg border-2">
             <CardHeader className="space-y-1 pb-3 sm:pb-4 px-4 sm:px-6 pt-4 sm:pt-6 text-center">
@@ -111,7 +111,7 @@ export default function ForgotPasswordPage() {
         </div>
       </div>);
     }
-    return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
+    return (<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
       <div className="w-full max-w-md">
         <div className="text-center mb-6 sm:mb-8 space-y-3 sm:space-y-4">
           <Link href="/" className="inline-block mb-3 sm:mb-4 transition-transform hover:scale-105">
diff --git a/fashion-ecommerce/app/login/page.jsx b/fashion-ecommerce/app/login/page.jsx
index 5eb9c72..ab996fd 100644
--- a/fashion-ecommerce/app/login/page.jsx
+++ b/fashion-ecommerce/app/login/page.jsx
@@ -12,6 +12,7 @@ import { useRouter } from "next/navigation";
 import { useAuth } from "@/lib/auth";
 import { Logo } from "@/components/logo";
 import logger from "@/lib/logger";
+import { API_BASE_URL } from "@/lib/api";
 import { Eye, EyeOff, Mail, Lock, User, Loader2 } from "lucide-react";
 import { Separator } from "@/components/ui/separator";
 const loginSchema = z.object({
@@ -138,8 +139,8 @@ export default function LoginPage() {
         setErrors(newErrors);
         return Object.keys(newErrors).length === 0;
     };
-    const handleGoogleCredentialResponse = useCallback(async (response) => {
-        if (!response?.credential) {
+    const exchangeGoogleToken = useCallback(async (idToken) => {
+        if (!idToken) {
             toast({
                 title: "Google login failed",
                 description: "No credential returned by Google.",
@@ -149,15 +150,14 @@ export default function LoginPage() {
         }
         setIsGoogleLoading(true);
         try {
-            const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5001/api";
-            const backendResponse = await fetch(`${API_BASE_URL}/auth/google`, {
+            const backendResponse = await fetch(`${API_BASE_URL()}/auth/google`, {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
                 },
                 credentials: "include",
                 body: JSON.stringify({
-                    idToken: response.credential,
+                    idToken,
                 }),
             });
             const data = await backendResponse.json();
@@ -191,6 +191,29 @@ export default function LoginPage() {
             setIsGoogleLoading(false);
         }
     }, [toast]);
+    const handleGoogleCredentialResponse = useCallback(async (response) => {
+        await exchangeGoogleToken(response?.credential);
+    }, [exchangeGoogleToken]);
+    const handleNativeGoogleLogin = useCallback(async () => {
+        try {
+            const { GoogleAuth } = await import("@codetrix-studio/capacitor-google-auth");
+            const clientId = process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID;
+            if (clientId) {
+                await GoogleAuth.initialize({ clientId });
+            }
+            const result = await GoogleAuth.signIn();
+            const idToken = result?.authentication?.idToken || result?.idToken;
+            await exchangeGoogleToken(idToken);
+        }
+        catch (error) {
+            logger.error("Google native login error:", error);
+            toast({
+                title: "Google login failed",
+                description: error?.message || "Please try again.",
+                variant: "destructive",
+            });
+        }
+    }, [exchangeGoogleToken, toast]);
     useEffect(() => {
         if (typeof window === "undefined")
             return;
@@ -202,6 +225,9 @@ export default function LoginPage() {
     useEffect(() => {
         if (typeof window === "undefined")
             return;
+        if (window?.Capacitor?.isNativePlatform?.()) {
+            return;
+        }
         const clientId = process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID;
         if (!clientId) {
             logger.error("Missing NEXT_PUBLIC_GOOGLE_CLIENT_ID");
@@ -320,7 +346,7 @@ export default function LoginPage() {
                 errorMessage.includes("ERR_NETWORK")) {
                 errorTitle = "🔌 Connection Error";
                 errorMessage = "Cannot connect to the server";
-                errorDetails = "The backend server is not running or not accessible. Please:\n• Make sure the backend server is running on http://localhost:5000\n• Check if the server is started correctly\n• Verify your internet connection";
+                errorDetails = `The backend server is not running or not accessible. Please:\n• Make sure the backend server is running on ${API_BASE_URL().replace("/api", "")}\n• Check if the server is started correctly\n• Verify your internet connection`;
             }
             else if (errorMessage.includes("Invalid email or password") || errorMessage.includes("Invalid credentials") || errorMessage.includes("401")) {
                 errorTitle = "Authentication Failed";
@@ -441,7 +467,7 @@ export default function LoginPage() {
                 errorDetails = (<div className="space-y-1">
             <p>The backend server is not running or not accessible.</p>
             <ul className="list-disc list-inside text-xs space-y-0.5 mt-1">
-              <li>Make sure the backend server is running on http://localhost:5000</li>
+              <li>Make sure the backend server is running on {API_BASE_URL().replace("/api", "")}</li>
               <li>Check if the server is started correctly</li>
               <li>Verify your internet connection</li>
             </ul>
@@ -497,7 +523,7 @@ export default function LoginPage() {
             });
         }
     };
-    return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
+    return (<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
       <div className="w-full max-w-md">
         
         <div className="text-center mb-6 sm:mb-8 space-y-4 sm:space-y-5">
@@ -668,7 +694,13 @@ export default function LoginPage() {
                 <Loader2 className="h-5 w-5 animate-spin text-primary"/>
               </div>)}
               <div className="mx-auto flex w-full max-w-xs justify-center sm:max-w-sm">
-                <div ref={googleButtonRef} className="inline-block" />
+                {typeof window !== "undefined" && window?.Capacitor?.isNativePlatform?.() ? (
+                  <Button variant="outline" type="button" className="w-full h-12 sm:h-14 text-base font-semibold" onClick={handleNativeGoogleLogin} disabled={isGoogleLoading}>
+                    {isGoogleLoading ? (<><Loader2 className="mr-2 h-4 w-4 animate-spin" />جاري التحميل...</>) : "تسجيل الدخول باستخدام Google"}
+                  </Button>
+                ) : (
+                  <div ref={googleButtonRef} className="inline-block" />
+                )}
               </div>
             </div>
 
diff --git a/fashion-ecommerce/app/my-designs/page.jsx b/fashion-ecommerce/app/my-designs/page.jsx
index c4f69fa..bb3d01e 100644
--- a/fashion-ecommerce/app/my-designs/page.jsx
+++ b/fashion-ecommerce/app/my-designs/page.jsx
@@ -11,6 +11,7 @@ import { designsApi } from "@/lib/api/designs";
 import { useAuth } from "@/lib/auth";
 import { useRouter } from "next/navigation";
 import { useToast } from "@/hooks/use-toast";
+import { sanitizeExternalUrl } from "@/lib/api";
 import logger from "@/lib/logger";
 import { ProfessionalNavbar } from "@/components/professional-navbar";
 import { useCart } from "@/lib/cart";
@@ -65,7 +66,7 @@ const parseLocalDesigns = (key) => {
         return parsed.map((design) => ({
             _id: design.id,
             name: design.name || "My design",
-            thumbnail: design.thumbnail || "",
+            thumbnail: sanitizeExternalUrl(design.thumbnail || ""),
             createdAt: design.createdAt || new Date().toISOString(),
             updatedAt: design.createdAt || new Date().toISOString(),
             baseProduct: {
@@ -206,7 +207,7 @@ export default function MyDesignsPage() {
                 quantity: 1,
                 size,
                 color,
-                image: design.thumbnail || design.designImageURL || "",
+                image: sanitizeExternalUrl(design.thumbnail || design.designImageURL || ""),
                 isCustom: true,
                 notes: orderNotes || undefined,
                 design: design._id,
@@ -339,7 +340,7 @@ export default function MyDesignsPage() {
           </Card>) : viewMode === "grid" ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
             {filteredDesigns.map((design) => (<Card key={design._id} className="group overflow-hidden hover:shadow-lg transition-shadow">
                 <div className="relative aspect-square bg-muted overflow-hidden">
-                  <Image src={design.thumbnail || "/placeholder-logo.png"} alt={design.name} fill className="object-cover group-hover:scale-105 transition-transform duration-300" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"/>
+                  <Image src={sanitizeExternalUrl(design.thumbnail || "") || "/placeholder-logo.png"} alt={design.name} fill className="object-cover group-hover:scale-105 transition-transform duration-300" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"/>
                   {design.status === "published" && (<Badge className="absolute top-3 left-3 bg-green-500">Published</Badge>)}
                   <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                     <Link href={getDesignLink(design)}>
@@ -380,7 +381,7 @@ export default function MyDesignsPage() {
                 <CardContent className="p-6">
                   <div className="flex gap-6">
                     <div className="w-32 h-32 rounded-lg bg-muted overflow-hidden flex-shrink-0 relative">
-                      <Image src={design.thumbnail || "/placeholder-logo.png"} alt={design.name} fill className="object-cover" sizes="128px"/>
+                      <Image src={sanitizeExternalUrl(design.thumbnail || "") || "/placeholder-logo.png"} alt={design.name} fill className="object-cover" sizes="128px"/>
                     </div>
                     <div className="flex-1">
                       <div className="flex items-start justify-between mb-2">
diff --git a/fashion-ecommerce/app/new-arrival/page.jsx b/fashion-ecommerce/app/new-arrival/page.jsx
index c9911d2..4cbe89c 100644
--- a/fashion-ecommerce/app/new-arrival/page.jsx
+++ b/fashion-ecommerce/app/new-arrival/page.jsx
@@ -15,6 +15,7 @@ import { useAuth } from "@/lib/auth";
 import { useToast } from "@/hooks/use-toast";
 import { favoritesApi } from "@/lib/api/favorites";
 import { useCart } from "@/lib/cart";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { useRouter } from "next/navigation";
 export default function NewArrivalPage() {
     const { formatPrice } = useRegion();
@@ -241,7 +242,7 @@ export default function NewArrivalPage() {
                     <Link href={`/products/${productId}`}>
                       <Card className="group overflow-hidden bg-white backdrop-blur-sm border-2 border-gray-200 hover:bg-white hover:border-rose-300 hover:shadow-xl transition-all duration-300 rounded-xl sm:rounded-2xl cursor-pointer h-full flex flex-col">
                         <div className="aspect-square overflow-hidden bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                          <Image src={product.image || "/placeholder-logo.png"} alt={product.name} width={300} height={300} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/>
+                          <Image src={sanitizeExternalUrl(product.image || "") || "/placeholder-logo.png"} alt={product.name} width={300} height={300} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/>
                           <div className="absolute inset-0 bg-gradient-to-t from-white/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"/>
                           <div className="absolute top-2 left-2 sm:top-3 sm:left-3 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-all duration-300">
                             <Badge className="text-xs sm:text-sm bg-rose-500 text-white border-0 rounded-full px-2 sm:px-3 py-1">
diff --git a/fashion-ecommerce/app/page.jsx b/fashion-ecommerce/app/page.jsx
index e52f7a4..7ddad00 100644
--- a/fashion-ecommerce/app/page.jsx
+++ b/fashion-ecommerce/app/page.jsx
@@ -17,6 +17,7 @@ import { listProducts } from "@/lib/api/products";
 import { featureControlsApi } from "@/lib/api/featureControls";
 import { studioProductsApi } from "@/lib/api/studioProducts";
 import { FeaturedProductsSkeleton } from "@/components/skeletons";
+import { sanitizeExternalUrl } from "@/lib/api";
 const Background3DSimple = dynamic(() => import("@/components/3d-background").then((mod) => mod.Background3DSimple), { ssr: false });
 const sliderImages = [
     {
@@ -130,7 +131,7 @@ export default function HomePage() {
                         .map((product) => ({
                         id: product._id || product.id || product.name,
                         name: product.name || "Studio Hoodie",
-                        image: product.viewMockups?.front || product.baseMockupUrl || product.image || "",
+                        image: sanitizeExternalUrl(product.viewMockups?.front || product.baseMockupUrl || product.image || ""),
                         price: product.price ?? 0,
                         category: product.type || "Studio",
                     }))
@@ -239,14 +240,14 @@ export default function HomePage() {
         }, 4000);
         return () => clearInterval(interval);
     }, [hoodieCarouselApi, hoodieProducts.length]);
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white">
       
       <ProfessionalNavbar />
 
       
-      <section className="relative overflow-hidden min-h-screen flex items-center pt-20">
+      <section className="relative overflow-hidden min-h-[100svh] flex items-center pt-20">
         
-        <div className="relative w-full h-screen" onMouseEnter={() => setIsPaused(true)} onMouseLeave={() => setIsPaused(false)} onTouchStart={() => setIsPaused(true)} onTouchEnd={() => setIsPaused(false)}>
+        <div className="relative w-full h-[100svh]" onMouseEnter={() => setIsPaused(true)} onMouseLeave={() => setIsPaused(false)} onTouchStart={() => setIsPaused(true)} onTouchEnd={() => setIsPaused(false)}>
           <AnimatePresence mode="sync" initial={false} custom={slideDirection}>
             <motion.div key={currentSlide} custom={slideDirection} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.9, ease: [0.22, 1, 0.36, 1] }} className="absolute inset-0 flex items-center overflow-hidden" style={{ backgroundImage: activeSlide.bgGradient || "linear-gradient(135deg, #fff1f2 0%, #fdf2f8 50%, #ffe4e6 100%)" }}>
               
@@ -358,7 +359,7 @@ export default function HomePage() {
                         <div className="absolute bottom-4 left-4 w-16 h-16 bg-gradient-to-br from-pink-200/30 to-rose-200/30 rounded-full blur-xl"/>
                         
                         <div className="relative w-full h-full min-h-[350px] lg:min-h-[550px]">
-                          <Image src={activeSlide.image} alt={activeSlide.title} fill className="object-contain rounded-2xl" priority={currentSlide === 0} sizes="(max-width: 768px) 100vw, 50vw"/>
+                          <Image src={sanitizeExternalUrl(activeSlide.image || "") || "/placeholder-logo.png"} alt={activeSlide.title} fill className="object-contain rounded-2xl" priority={currentSlide === 0} sizes="(max-width: 768px) 100vw, 50vw"/>
                         </div>
                       </div>
                     </div>
@@ -438,7 +439,7 @@ export default function HomePage() {
                         <Link href={`/products/${product._id || product.id}`} className="block">
                           <motion.div whileHover={{ y: -8, scale: 1.02 }} className="bg-white rounded-2xl overflow-hidden border border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all">
                             <div className="aspect-square bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                              {product.image ? (<Image src={product.image} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
+                              {product.image ? (<Image src={sanitizeExternalUrl(product.image) || "/placeholder-logo.png"} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
                                   <div className="text-4xl font-bold text-gray-300">{product.name.charAt(0)}</div>
                                 </div>)}
                               <div className="absolute top-3 left-3">
@@ -495,7 +496,7 @@ export default function HomePage() {
                         <Link href={`/studio?product=${product.id}`} className="block">
                           <motion.div whileHover={{ y: -8, scale: 1.02 }} className="bg-white rounded-2xl overflow-hidden border border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all">
                             <div className="aspect-square bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                              {product.image ? (<Image src={product.image} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
+                              {product.image ? (<Image src={sanitizeExternalUrl(product.image) || "/placeholder-logo.png"} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
                                   <div className="text-4xl font-bold text-gray-300">{product.name.charAt(0)}</div>
                                 </div>)}
                             </div>
@@ -542,7 +543,7 @@ export default function HomePage() {
                 <div className="absolute -inset-2 rounded-3xl bg-rose-200/40 blur-2xl" aria-hidden="true"/>
                 <div className="relative overflow-hidden rounded-3xl border border-rose-200 bg-white shadow-xl">
                   <div className="relative aspect-[4/3]">
-                    <img src="https://res.cloudinary.com/fashionhub1/image/upload/v1768498925/stylecraft/virtual-try-on/j0qvmnzfwpc2ydfeb757.png" alt={language === "ar" ? "معاينة التجربة الافتراضية" : "Virtual try-on preview"} className="h-full w-full object-cover"/>
+                    <img src="/try-on.png" alt={language === "ar" ? "معاينة التجربة الافتراضية" : "Virtual try-on preview"} className="h-full w-full object-cover"/>
                   </div>
                 </div>
               </div>
@@ -579,7 +580,7 @@ export default function HomePage() {
                         <Link href={`/products/${product._id || product.id}`} className="block">
                           <motion.div whileHover={{ y: -8, scale: 1.02 }} className="bg-white rounded-2xl overflow-hidden border border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all">
                             <div className="aspect-square bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                              {product.image ? (<Image src={product.image} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
+                              {product.image ? (<Image src={sanitizeExternalUrl(product.image) || "/placeholder-logo.png"} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
                                   <div className="text-4xl font-bold text-gray-300">{product.name.charAt(0)}</div>
                                 </div>)}
                             </div>
@@ -625,7 +626,7 @@ export default function HomePage() {
                         <Link href={`/products/${product._id || product.id}`} className="block">
                           <motion.div whileHover={{ y: -8, scale: 1.02 }} className="bg-white rounded-2xl overflow-hidden border border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all">
                             <div className="aspect-square bg-gradient-to-br from-pink-50 to-rose-50 relative">
-                              {product.image ? (<Image src={product.image} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
+                              {product.image ? (<Image src={sanitizeExternalUrl(product.image) || "/placeholder-logo.png"} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
                                   <div className="text-4xl font-bold text-gray-300">{product.name.charAt(0)}</div>
                                 </div>)}
                             </div>
@@ -671,7 +672,7 @@ export default function HomePage() {
                         <Link href={`/products/${product._id || product.id}`} className="block">
                           <motion.div whileHover={{ y: -8, scale: 1.02 }} className="bg-white rounded-2xl overflow-hidden border border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all">
                             <div className="aspect-square bg-gradient-to-br from-amber-50 to-orange-50 relative">
-                              {product.image ? (<Image src={product.image} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
+                              {product.image ? (<Image src={sanitizeExternalUrl(product.image) || "/placeholder-logo.png"} alt={product.name} fill className="object-cover"/>) : (<div className="w-full h-full flex items-center justify-center">
                                   <div className="text-4xl font-bold text-gray-300">{product.name.charAt(0)}</div>
                                 </div>)}
                             </div>
@@ -750,7 +751,7 @@ export default function HomePage() {
               {featuredProducts.map((product, index) => (<Link key={product._id || product.id || index} href={`/products/${product._id || product.id}`}>
                   <motion.div initial={{ opacity: 0, y: 30 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true }} transition={{ duration: 0.6, delay: index * 0.1 }} whileHover={{ y: -8, transition: { duration: 0.3 } }} className="group rounded-2xl overflow-hidden bg-white/90 backdrop-blur-sm border border-gray-200 hover:bg-white hover:border-rose-300 hover:shadow-xl transition-all duration-300">
                     <div className="aspect-square bg-gradient-to-br from-rose-50 to-pink-50 relative overflow-hidden">
-                      {product.image ? (<Image src={product.image} alt={product.name || "Product"} fill className="object-cover group-hover:scale-110 transition-transform duration-300" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"/>) : (<div className="w-full h-full flex items-center justify-center">
+                      {product.image ? (<Image src={sanitizeExternalUrl(product.image) || "/placeholder-logo.png"} alt={product.name || "Product"} fill className="object-cover group-hover:scale-110 transition-transform duration-300" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"/>) : (<div className="w-full h-full flex items-center justify-center">
                           <div className="text-6xl font-bold text-gray-200">{(product.name || "P").charAt(0)}</div>
                         </div>)}
                       <div className="absolute top-3 left-3">
diff --git a/fashion-ecommerce/app/profile/page.jsx b/fashion-ecommerce/app/profile/page.jsx
index 1fecf18..f8c5bda 100644
--- a/fashion-ecommerce/app/profile/page.jsx
+++ b/fashion-ecommerce/app/profile/page.jsx
@@ -12,6 +12,7 @@ import { Badge } from "@/components/ui/badge";
 import { useAuth } from "@/lib/auth";
 import { useRouter } from "next/navigation";
 import { useToast } from "@/hooks/use-toast";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { authApi } from "@/lib/api/auth";
 import { ordersApi } from "@/lib/api/orders";
 import { designsApi } from "@/lib/api/designs";
@@ -66,7 +67,7 @@ const parseLocalDesigns = (key) => {
         return parsed.map((design) => ({
             _id: design.id,
             name: design.name || "My design",
-            thumbnail: design.thumbnail || "",
+            thumbnail: sanitizeExternalUrl(design.thumbnail || ""),
             createdAt: design.createdAt || new Date().toISOString(),
             updatedAt: design.createdAt || new Date().toISOString(),
             baseProduct: {
@@ -222,7 +223,7 @@ export default function ProfilePage() {
     const getDesignLink = (design) => design.isLocal
         ? `/studio?localDesign=${design._id}`
         : `/studio?design=${design._id}`;
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white pt-20 sm:pt-24">
       <div className="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-24 py-6 sm:py-8 md:py-12">
         <div className="max-w-6xl mx-auto">
           <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 sm:mb-12 gap-4">
@@ -238,24 +239,24 @@ export default function ProfilePage() {
           </motion.div>
 
           <Tabs defaultValue="profile" className="space-y-6 sm:space-y-8">
-            <TabsList className="grid w-full grid-cols-2 sm:grid-cols-5 bg-white backdrop-blur-sm border-2 border-gray-200 p-2 rounded-xl sm:rounded-2xl h-auto gap-2">
-              <TabsTrigger value="profile" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
+            <TabsList className="flex w-full flex-nowrap overflow-x-auto sm:grid sm:grid-cols-5 bg-white backdrop-blur-sm border-2 border-gray-200 p-2 rounded-xl sm:rounded-2xl h-auto gap-2">
+              <TabsTrigger value="profile" className="whitespace-nowrap data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
                 <User className="h-4 w-4 sm:h-5 sm:w-5 mr-2"/>
                 Profile
               </TabsTrigger>
-              <TabsTrigger value="orders" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
+              <TabsTrigger value="orders" className="whitespace-nowrap data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
                 <Package className="h-4 w-4 sm:h-5 sm:w-5 mr-2"/>
                 Orders
               </TabsTrigger>
-              <TabsTrigger value="designs" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
+              <TabsTrigger value="designs" className="whitespace-nowrap data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
                 <Heart className="h-4 w-4 sm:h-5 sm:w-5 mr-2"/>
                 Designs
               </TabsTrigger>
-              <TabsTrigger value="addresses" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
+              <TabsTrigger value="addresses" className="whitespace-nowrap data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
                 <MapPin className="h-4 w-4 sm:h-5 sm:w-5 mr-2"/>
                 Addresses
               </TabsTrigger>
-              <TabsTrigger value="settings" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
+              <TabsTrigger value="settings" className="whitespace-nowrap data-[state=active]:bg-gradient-to-r data-[state=active]:from-rose-500 data-[state=active]:to-pink-500 data-[state=active]:text-white text-gray-600 rounded-lg sm:rounded-xl h-10 sm:h-12 text-sm sm:text-base">
                 <Settings className="h-4 w-4 sm:h-5 sm:w-5 mr-2"/>
                 Settings
               </TabsTrigger>
@@ -289,8 +290,8 @@ export default function ProfilePage() {
                     <Input id="phone" value={userData.phone} onChange={(e) => setUserData({ ...userData, phone: e.target.value })}/>
                   </div>
 
-                  <div className="flex gap-4">
-                    <Button className="bg-gradient-to-r from-rose-500 to-pink-500 text-white hover:from-rose-600 hover:to-pink-600 rounded-full" onClick={async () => {
+                  <div className="flex flex-col sm:flex-row gap-3">
+                    <Button className="w-full sm:w-auto bg-gradient-to-r from-rose-500 to-pink-500 text-white hover:from-rose-600 hover:to-pink-600 rounded-full" onClick={async () => {
             try {
                 await authApi.updateProfile({
                     firstName: userData.firstName,
@@ -320,7 +321,7 @@ export default function ProfilePage() {
         }}>
                       Save Changes
                     </Button>
-                    <Button variant="outline" className="bg-white border-2 border-gray-200 hover:bg-rose-50 hover:border-rose-300 text-gray-700 hover:text-rose-600 rounded-full" onClick={() => {
+                    <Button variant="outline" className="w-full sm:w-auto bg-white border-2 border-gray-200 hover:bg-rose-50 hover:border-rose-300 text-gray-700 hover:text-rose-600 rounded-full" onClick={() => {
             setUserData({
                 firstName: user?.firstName || "",
                 lastName: user?.lastName || "",
@@ -357,7 +358,7 @@ export default function ProfilePage() {
                     <Label htmlFor="confirmNewPassword">Confirm New Password</Label>
                     <Input id="confirmNewPassword" type="password"/>
                   </div>
-                  <Button>Update Password</Button>
+                  <Button className="w-full sm:w-auto">Update Password</Button>
                 </CardContent>
               </Card>
             </TabsContent>
@@ -378,9 +379,9 @@ export default function ProfilePage() {
                 </Card>) : (<div className="space-y-4">
                   {orders.map((order) => (<Card key={order._id} className="bg-white backdrop-blur-sm border-2 border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all rounded-xl sm:rounded-2xl">
                       <CardContent className="p-6">
-                        <div className="flex items-start justify-between mb-4">
-                          <div>
-                            <h3 className="font-semibold text-lg text-gray-900">{order.orderNumber}</h3>
+                    <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 mb-4">
+                      <div>
+                        <h3 className="font-semibold text-lg text-gray-900">{order.orderNumber}</h3>
                             <p className="text-sm text-gray-600">
                               Placed on {new Date(order.createdAt).toLocaleDateString()}
                             </p>
@@ -397,7 +398,7 @@ export default function ProfilePage() {
                         <div className="space-y-3 mb-4">
                           {order.items.map((item, index) => (<div key={index} className="flex gap-4">
                               <div className="w-16 h-16 rounded-lg bg-gradient-to-br from-rose-50 to-pink-50 flex-shrink-0 relative overflow-hidden border-2 border-gray-200">
-                                <Image src={item.image || "/placeholder-logo.png"} alt={item.name} fill className="object-cover" sizes="64px"/>
+                                <Image src={sanitizeExternalUrl(item.image || "") || "/placeholder-logo.png"} alt={item.name} fill className="object-cover" sizes="64px"/>
                               </div>
                               <div className="flex-1">
                                 <p className="font-medium text-gray-900">{item.name}</p>
@@ -408,7 +409,7 @@ export default function ProfilePage() {
                             </div>))}
                         </div>
 
-                        <div className="flex items-center justify-between pt-4 border-t border-gray-200">
+                        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pt-4 border-t border-gray-200">
                           <p className="font-semibold text-gray-900">Total: ${order.total.toFixed(2)}</p>
                           <div className="flex gap-2">
                             <Button variant="outline" size="sm" asChild className="bg-white border-2 border-gray-200 hover:bg-rose-50 hover:border-rose-300 text-gray-700 hover:text-rose-600 rounded-full">
@@ -439,7 +440,7 @@ export default function ProfilePage() {
                 </Card>) : (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                   {allDesigns.map((design) => (<Card key={design._id} className="overflow-hidden bg-white backdrop-blur-sm border-2 border-gray-200 hover:border-rose-300 hover:shadow-xl transition-all rounded-xl sm:rounded-2xl">
                       <div className="aspect-square bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                        <Image src={design.thumbnail || "/placeholder-logo.png"} alt={design.name} fill className="object-cover" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"/>
+                        <Image src={sanitizeExternalUrl(design.thumbnail || "") || "/placeholder-logo.png"} alt={design.name} fill className="object-cover" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"/>
                       </div>
                       <CardContent className="p-4">
                         <h3 className="font-semibold mb-1 text-gray-900">{design.name}</h3>
diff --git a/fashion-ecommerce/app/reset-password/page.jsx b/fashion-ecommerce/app/reset-password/page.jsx
index a9edc25..050b6f9 100644
--- a/fashion-ecommerce/app/reset-password/page.jsx
+++ b/fashion-ecommerce/app/reset-password/page.jsx
@@ -10,6 +10,7 @@ import { useToast } from "@/hooks/use-toast";
 import { Logo } from "@/components/logo";
 import { ArrowLeft, CheckCircle2, Eye, EyeOff, Loader2, Lock } from "lucide-react";
 import logger from "@/lib/logger";
+import { API_BASE_URL } from "@/lib/api";
 function ResetPasswordContent() {
     const searchParams = useSearchParams();
     const router = useRouter();
@@ -59,8 +60,7 @@ function ResetPasswordContent() {
         setIsLoading(true);
         logger.log("Resetting password for:", email);
         try {
-            const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
-            const response = await fetch(`${API_BASE_URL}/auth/reset-password`, {
+            const response = await fetch(`${API_BASE_URL()}/auth/reset-password`, {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
@@ -101,7 +101,7 @@ function ResetPasswordContent() {
         }
     };
     if (isSuccess) {
-        return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
+        return (<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
         <div className="w-full max-w-md">
           <Card className="shadow-lg border-2">
             <CardHeader className="space-y-1 pb-3 sm:pb-4 px-4 sm:px-6 pt-4 sm:pt-6 text-center">
@@ -125,7 +125,7 @@ function ResetPasswordContent() {
         </div>
       </div>);
     }
-    return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
+    return (<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
       <div className="w-full max-w-md">
         <div className="text-center mb-6 sm:mb-8 space-y-3 sm:space-y-4">
           <Link href="/" className="inline-block mb-3 sm:mb-4 transition-transform hover:scale-105">
@@ -203,7 +203,7 @@ function ResetPasswordContent() {
 }
 
 export default function ResetPasswordPage() {
-    return (<Suspense fallback={<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20"/>}>
+    return (<Suspense fallback={<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20"/>}>
       <ResetPasswordContent />
     </Suspense>);
 }
diff --git a/fashion-ecommerce/app/sale/page.jsx b/fashion-ecommerce/app/sale/page.jsx
index c18751d..334efbd 100644
--- a/fashion-ecommerce/app/sale/page.jsx
+++ b/fashion-ecommerce/app/sale/page.jsx
@@ -11,6 +11,7 @@ import { useLanguage } from "@/lib/language";
 import { ProductGridSkeleton } from "@/components/skeletons";
 import { ProfessionalNavbar } from "@/components/professional-navbar";
 import { Tag } from "lucide-react";
+import { sanitizeExternalUrl } from "@/lib/api";
 export default function SalePage() {
     const { formatPrice } = useRegion();
     const { language } = useLanguage();
@@ -33,7 +34,7 @@ export default function SalePage() {
         };
         load();
     }, []);
-    return (<div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white">
+    return (<div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white">
       <ProfessionalNavbar />
       
       <div className="container mx-auto px-4 sm:px-6 md:px-12 lg:px-24 py-8 sm:py-12 pt-24 sm:pt-28">
@@ -67,7 +68,7 @@ export default function SalePage() {
                   <Link href={`/products/${productId}`}>
                     <Card className="group overflow-hidden bg-white backdrop-blur-sm border-2 border-gray-200 hover:bg-white hover:border-rose-300 hover:shadow-xl transition-all duration-300 rounded-xl sm:rounded-2xl cursor-pointer h-full flex flex-col">
                       <div className="aspect-square overflow-hidden bg-gradient-to-br from-rose-50 to-pink-50 relative">
-                        <Image src={product.image || "/placeholder-logo.png"} alt={product.name} width={300} height={300} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/>
+                        <Image src={sanitizeExternalUrl(product.image || "") || "/placeholder-logo.png"} alt={product.name} width={300} height={300} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/>
                         
                         <div className="absolute top-2 right-2 sm:top-3 sm:right-3">
                           <Badge className="bg-red-500 text-white border-0 rounded-full px-2 sm:px-3 py-1 text-xs sm:text-sm font-bold shadow-lg">
diff --git a/fashion-ecommerce/app/signup/page.jsx b/fashion-ecommerce/app/signup/page.jsx
index c858122..5672dc2 100644
--- a/fashion-ecommerce/app/signup/page.jsx
+++ b/fashion-ecommerce/app/signup/page.jsx
@@ -12,6 +12,7 @@ import { useAuth } from "@/lib/auth";
 import { Logo } from "@/components/logo";
 import { Eye, EyeOff, Mail, Lock, User, Loader2 } from "lucide-react";
 import { Separator } from "@/components/ui/separator";
+import { API_BASE_URL } from "@/lib/api";
 export default function SignupPage() {
     const router = useRouter();
     const [formData, setFormData] = useState({
@@ -93,7 +94,7 @@ export default function SignupPage() {
                 errorMessage = error;
             }
             if (errorMessage.includes("Cannot connect to the server") || errorMessage.includes("Failed to fetch")) {
-                errorMessage = "Cannot connect to the server. Please make sure the backend server is running on http://localhost:5000";
+                errorMessage = `Cannot connect to the server. Please make sure the backend server is running on ${API_BASE_URL().replace("/api", "")}`;
             }
             toast({
                 title: "Registration failed",
@@ -115,6 +116,86 @@ export default function SignupPage() {
             setErrors({ ...errors, [e.target.id]: "" });
         }
     };
+    const exchangeGoogleToken = async (idToken) => {
+        if (!idToken) {
+            toast({
+                title: "Google login failed",
+                description: "No credential returned by Google.",
+                variant: "destructive",
+            });
+            return;
+        }
+        setIsGoogleLoading(true);
+        try {
+            toast({
+                title: "جاري إنشاء الحساب...",
+                description: "يرجى الانتظار",
+            });
+            const backendResponse = await fetch(`${API_BASE_URL()}/auth/google`, {
+                method: 'POST',
+                headers: {
+                    'Content-Type': 'application/json',
+                },
+                credentials: 'include',
+                body: JSON.stringify({
+                    idToken,
+                }),
+            });
+            const data = await backendResponse.json();
+            if (!backendResponse.ok || !data.success) {
+                throw new Error(data.message || 'Google login failed');
+            }
+            if (data.data.token) {
+                localStorage.setItem('auth_token', data.data.token);
+            }
+            toast({
+                title: "تم إنشاء الحساب بنجاح! ✨",
+                description: `مرحباً ${data.data.user.firstName}!`,
+            });
+            const role = String(data.data.user.role || "").toLowerCase().trim();
+            const redirectUrl = role === "admin"
+                ? "/admin"
+                : role === "employee"
+                    ? "/employee"
+                    : "/profile";
+            router.replace(redirectUrl);
+        }
+        catch (error) {
+            console.error("❌ Google login error:", error);
+            toast({
+                title: "فشل التسجيل",
+                description: error.message || "حدث خطأ أثناء التسجيل باستخدام Google",
+                variant: "destructive",
+            });
+        }
+        finally {
+            setIsGoogleLoading(false);
+        }
+    };
+    const handleNativeGoogleLogin = async (e) => {
+        if (e) {
+            e.preventDefault();
+            e.stopPropagation();
+        }
+        try {
+            const { GoogleAuth } = await import("@codetrix-studio/capacitor-google-auth");
+            const clientId = process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID;
+            if (clientId) {
+                await GoogleAuth.initialize({ clientId });
+            }
+            const result = await GoogleAuth.signIn();
+            const idToken = result?.authentication?.idToken || result?.idToken;
+            await exchangeGoogleToken(idToken);
+        }
+        catch (error) {
+            console.error("❌ Google native login error:", error);
+            toast({
+                title: "فشل التسجيل",
+                description: error.message || "حدث خطأ أثناء التسجيل باستخدام Google",
+                variant: "destructive",
+            });
+        }
+    };
     const handleGoogleLogin = async (e) => {
         if (e) {
             e.preventDefault();
@@ -123,6 +204,10 @@ export default function SignupPage() {
         if (isGoogleLoading) {
             return;
         }
+        if (typeof window !== "undefined" && window?.Capacitor?.isNativePlatform?.()) {
+            await handleNativeGoogleLogin(e);
+            return;
+        }
         const googleClientId = process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID;
         if (!googleClientId || googleClientId.trim() === '' || googleClientId.includes('your-google-client-id') || googleClientId.includes('placeholder')) {
             toast({
@@ -176,51 +261,7 @@ export default function SignupPage() {
                 }
             }
             const handleGoogleCallback = async (response) => {
-                try {
-                    setIsGoogleLoading(false);
-                    const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
-                    toast({
-                        title: "جاري إنشاء الحساب...",
-                        description: "يرجى الانتظار",
-                    });
-                    const backendResponse = await fetch(`${API_BASE_URL}/auth/google`, {
-                        method: 'POST',
-                        headers: {
-                            'Content-Type': 'application/json',
-                        },
-                        credentials: 'include',
-                        body: JSON.stringify({
-                            idToken: response.credential,
-                        }),
-                    });
-                    const data = await backendResponse.json();
-                    if (!backendResponse.ok || !data.success) {
-                        throw new Error(data.message || 'Google login failed');
-                    }
-                    if (data.data.token) {
-                        localStorage.setItem('auth_token', data.data.token);
-                    }
-                    toast({
-                        title: "تم إنشاء الحساب بنجاح! ✨",
-                        description: `مرحباً ${data.data.user.firstName}!`,
-                    });
-                    const role = String(data.data.user.role || "").toLowerCase().trim();
-                    const redirectUrl = role === "admin"
-                        ? "/admin"
-                        : role === "employee"
-                            ? "/employee"
-                            : "/profile";
-                    router.replace(redirectUrl);
-                }
-                catch (error) {
-                    setIsGoogleLoading(false);
-                    console.error("❌ Google login error:", error);
-                    toast({
-                        title: "فشل التسجيل",
-                        description: error.message || "حدث خطأ أثناء التسجيل باستخدام Google",
-                        variant: "destructive",
-                    });
-                }
+                await exchangeGoogleToken(response?.credential);
             };
             if (!window.google.accounts?.id?._clientId) {
                 window.google.accounts.id.initialize({
@@ -258,7 +299,7 @@ export default function SignupPage() {
             setIsGoogleLoading(false);
         }
     };
-    return (<div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4">
+    return (<div className="min-h-[100svh] bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center p-4 sm:p-6 md:p-8">
       <div className="w-full max-w-md">
         
         <div className="text-center mb-8 space-y-5">
@@ -282,7 +323,7 @@ export default function SignupPage() {
           <CardContent className="space-y-6">
             <form onSubmit={handleSubmit} className="space-y-4">
               
-              <div className="grid grid-cols-2 gap-4">
+              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                 <div className="space-y-2">
                   <Label htmlFor="firstName">First Name</Label>
                   <div className="relative">
diff --git a/fashion-ecommerce/app/studio/components/ProductPreview.jsx b/fashion-ecommerce/app/studio/components/ProductPreview.jsx
index c0e6260..dc356d6 100644
--- a/fashion-ecommerce/app/studio/components/ProductPreview.jsx
+++ b/fashion-ecommerce/app/studio/components/ProductPreview.jsx
@@ -1,7 +1,8 @@
 "use client";
 import { getProductImagePath } from "../utils/productImages";
+import { sanitizeExternalUrl } from "@/lib/api";
 export function ProductPreview({ productType, productColor, currentSide, onSideChange: _onSideChange, designElements, zoom = 100, safeArea, mockupUrl, }) {
-    const currentImage = mockupUrl || getProductImagePath(productType, currentSide);
+    const currentImage = sanitizeExternalUrl(mockupUrl || getProductImagePath(productType, currentSide)) || "/placeholder-logo.png";
     const currentSideElements = designElements.filter((el) => (el.side || "front") === currentSide);
     const isWhite = productColor.toLowerCase() === "#ffffff";
     return (<div className="flex flex-col h-full bg-muted/30">
@@ -19,7 +20,7 @@ export function ProductPreview({ productType, productColor, currentSide, onSideC
             filter: !isWhite ? "brightness(0.9)" : undefined,
         }} onError={(e) => {
             ;
-            e.target.src = mockupUrl || "/placeholder-logo.png";
+            e.target.src = currentImage || "/placeholder-logo.png";
         }}/>
 
             
diff --git a/fashion-ecommerce/app/studio/page.jsx b/fashion-ecommerce/app/studio/page.jsx
index 09e4696..88d44fb 100644
--- a/fashion-ecommerce/app/studio/page.jsx
+++ b/fashion-ecommerce/app/studio/page.jsx
@@ -32,6 +32,7 @@ import { cn } from "@/lib/utils";
 import { useToast } from "@/hooks/use-toast";
 import { useCart } from "@/lib/cart";
 import { useAuth } from "@/lib/auth";
+import { sanitizeExternalUrl } from "@/lib/api";
 import { useRouter, useSearchParams } from "next/navigation";
 import html2canvas from "html2canvas";
 import { studioProductsApi } from "@/lib/api/studioProducts";
@@ -124,6 +125,16 @@ const isValidObjectId = (value) => /^[0-9a-fA-F]{24}$/.test(String(value || ""))
 
 const normalizeColorKey = (value) => String(value || "").trim().toLowerCase();
 
+const resolveImageUrl = (value) => {
+  if (!value) return "";
+  if (typeof value === "string") return sanitizeExternalUrl(value);
+  if (value && typeof value === "object") {
+    const candidate = value.url || value.secure_url || value.path;
+    return typeof candidate === "string" ? sanitizeExternalUrl(candidate) : "";
+  }
+  return "";
+};
+
 const createEmptySideState = () => ({
   textValue: "",
   textFontSize: 16,
@@ -248,16 +259,29 @@ const resolveProductImage = (product, viewKey, colorKey) => {
   const colorView = normalizedColor ? getColorEntry(colorViews, normalizedColor) : null;
   const colorMockups = product.colorMockups || {};
   const colorMockup = normalizedColor ? getColorEntry(colorMockups, normalizedColor) : null;
-  const colorViewImage = colorView ? getViewEntry(colorView, normalizedViewKey) : null;
+  const colorViewImage = resolveImageUrl(
+    colorView ? getViewEntry(colorView, normalizedViewKey) : null
+  );
   if (colorViewImage) return colorViewImage;
-  const productViewImage = getViewEntry(product.viewMockups || {}, normalizedViewKey);
+  const productViewImage = resolveImageUrl(
+    getViewEntry(product.viewMockups || {}, normalizedViewKey)
+  );
   if (productViewImage) return productViewImage;
-  if (normalizedViewKey !== "front") return null;
-  if (colorView?.front) return colorView.front;
-  if (colorMockup) return colorMockup;
-  if (product.viewMockups?.front) return product.viewMockups.front;
+  if (normalizedViewKey !== "front") {
+    return (
+      resolveImageUrl(colorView?.front) ||
+      resolveImageUrl(product.viewMockups?.front) ||
+      resolveImageUrl(colorMockup) ||
+      resolveImageUrl(product.baseMockupUrl) ||
+      resolveImageUrl(product.image) ||
+      (colorImageMap[normalizedColor] || null)
+    );
+  }
+  if (colorView?.front) return resolveImageUrl(colorView.front);
+  if (colorMockup) return resolveImageUrl(colorMockup);
+  if (product.viewMockups?.front) return resolveImageUrl(product.viewMockups.front);
   if (colorImageMap[normalizedColor]) return colorImageMap[normalizedColor];
-  return product.baseMockupUrl || product.image;
+  return resolveImageUrl(product.baseMockupUrl) || resolveImageUrl(product.image);
 };
 
 export default function DesignStudioPage() {
@@ -1086,7 +1110,7 @@ export default function DesignStudioPage() {
   };
 
   return (
-    <div className="min-h-screen bg-gradient-to-b from-white via-rose-50/30 to-white flex flex-col pt-20">
+    <div className="min-h-[100svh] bg-gradient-to-b from-white via-rose-50/30 to-white flex flex-col pt-16 sm:pt-20">
       <div className="flex-1 flex flex-col xl:flex-row overflow-hidden">
         <div className="w-full xl:w-80 border-b border-gray-200 xl:border-b-0 xl:border-r bg-white overflow-hidden flex flex-col shadow-xl xl:flex-shrink-0">
           <div className="flex-1 overflow-y-auto p-4 space-y-6 studio-theme font-tajawal">
@@ -1104,10 +1128,15 @@ export default function DesignStudioPage() {
                     <>
                       <div className="aspect-square w-full bg-muted/30">
                         <img
-                          src={productPreviewImage || activeProduct?.image || "/placeholder-logo.png"}
+                          src={sanitizeExternalUrl(productPreviewImage || activeProduct?.image || "") || "/placeholder-logo.png"}
                           alt={activeProduct?.name || "Product"}
                           className="h-full w-full object-cover"
                           crossOrigin="anonymous"
+                          onError={(e) => {
+                            if (e.currentTarget.dataset.fallbackApplied) return;
+                            e.currentTarget.dataset.fallbackApplied = "true";
+                            e.currentTarget.src = "/placeholder-logo.png";
+                          }}
                         />
                       </div>
                       <div className="px-3 py-2 text-center space-y-2">
@@ -1176,7 +1205,7 @@ export default function DesignStudioPage() {
 
         <div className="flex-1 flex flex-col bg-muted/30 min-w-0 overflow-hidden">
 
-          <div className="flex-1 overflow-auto p-4 lg:p-6 min-h-0">
+          <div className="flex-1 overflow-auto overflow-x-auto p-4 lg:p-6 min-h-0">
             <div className="max-w-[1280px] mx-auto pt-4 lg:pt-6">
               <div className="flex flex-col lg:flex-row gap-6 lg:gap-8 items-start">
                 <div className="w-full lg:w-[200px] space-y-5 order-2 lg:order-1">
@@ -1255,7 +1284,7 @@ export default function DesignStudioPage() {
                 </div>
 
                 <div className="flex-1 min-w-0 order-1 lg:order-2">
-                  <div className="relative mx-auto w-full max-w-[1040px] 2xl:max-w-[1280px] shadow-2xl rounded-2xl overflow-hidden bg-background border border-border">
+                  <div className="relative mx-auto w-full min-w-[280px] sm:min-w-[320px] max-w-[1040px] 2xl:max-w-[1280px] shadow-2xl rounded-2xl overflow-hidden bg-background border border-border">
                     <div
                       style={{
                         backgroundImage: showGrid
@@ -1281,6 +1310,11 @@ export default function DesignStudioPage() {
                             alt={`${activeProduct?.name || "Product"} preview`}
                             className="w-full h-full rounded-2xl object-contain"
                             crossOrigin="anonymous"
+                            onError={(e) => {
+                              if (e.currentTarget.dataset.fallbackApplied) return;
+                              e.currentTarget.dataset.fallbackApplied = "true";
+                              e.currentTarget.src = "/placeholder-logo.png";
+                            }}
                           />
 
                           <div
@@ -1563,7 +1597,7 @@ export default function DesignStudioPage() {
                           <div className="relative w-full h-20 bg-muted">
                             {design.thumbnail ? (
                               <img
-                                src={design.thumbnail}
+                                src={sanitizeExternalUrl(design.thumbnail)}
                                 alt={design.name}
                                 className="h-full w-full object-cover"
                               />
diff --git a/fashion-ecommerce/components/staff-chat-panel.jsx b/fashion-ecommerce/components/staff-chat-panel.jsx
index 5cbf22d..df9c282 100644
--- a/fashion-ecommerce/components/staff-chat-panel.jsx
+++ b/fashion-ecommerce/components/staff-chat-panel.jsx
@@ -11,9 +11,9 @@ import { Textarea } from "@/components/ui/textarea";
 import { Badge } from "@/components/ui/badge";
 import { ScrollArea } from "@/components/ui/scroll-area";
 import { Loader2 } from "lucide-react";
+import { API_BASE_URL } from "@/lib/api";
 
-const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
-const SOCKET_URL = API_BASE_URL.replace(/\/api\/?$/, "");
+const SOCKET_URL = API_BASE_URL().replace(/\/api\/?$/, "");
 
 const getDisplayName = (user) => {
   if (!user) {
diff --git a/fashion-ecommerce/lib/api/auth.js b/fashion-ecommerce/lib/api/auth.js
index b085d22..ae448bf 100644
--- a/fashion-ecommerce/lib/api/auth.js
+++ b/fashion-ecommerce/lib/api/auth.js
@@ -2,11 +2,11 @@ import apiClient from "./client";
 import logger from "@/lib/logger";
 export const authApi = {
     async login(identifier, password) {
-        const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
+        const { API_BASE_URL } = await import("@/lib/api");
         const token = typeof window !== "undefined" ? localStorage.getItem("auth_token") : null;
         try {
-            logger.log("🔍 Attempting login to:", `${API_BASE_URL}/auth/login`);
-            const response = await fetch(`${API_BASE_URL}/auth/login`, {
+            logger.log("🔍 Attempting login to:", `${API_BASE_URL()}/auth/login`);
+            const response = await fetch(`${API_BASE_URL()}/auth/login`, {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
@@ -102,9 +102,9 @@ export const authApi = {
         catch (error) {
             if (error instanceof TypeError && error.message === "Failed to fetch") {
                 logger.error("❌ Network Error - Backend may be offline");
-                logger.error("API URL:", API_BASE_URL);
+                logger.error("API URL:", API_BASE_URL());
                 logger.error("Error:", error);
-                throw new Error(`Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL.replace("/api", "")}`);
+                throw new Error(`Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL().replace("/api", "")}`);
             }
             if (error instanceof Error) {
                 throw error;
@@ -124,10 +124,10 @@ export const authApi = {
         return await apiClient.put("/auth/profile", profileData);
     },
     async googleAuth(idToken) {
-        const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
+        const { API_BASE_URL } = await import("@/lib/api");
         try {
-            logger.log("🔍 Attempting Google auth to:", `${API_BASE_URL}/auth/google`);
-            const response = await fetch(`${API_BASE_URL}/auth/google`, {
+            logger.log("🔍 Attempting Google auth to:", `${API_BASE_URL()}/auth/google`);
+            const response = await fetch(`${API_BASE_URL()}/auth/google`, {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
@@ -153,7 +153,7 @@ export const authApi = {
         catch (error) {
             logger.error("❌ Google auth error:", error);
             if (error instanceof TypeError && error.message === "Failed to fetch") {
-                throw new Error(`Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL.replace("/api", "")}`);
+                throw new Error(`Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL().replace("/api", "")}`);
             }
             throw error instanceof Error ? error : new Error(error?.message || "An unexpected error occurred during Google authentication");
         }
diff --git a/fashion-ecommerce/lib/api/client.js b/fashion-ecommerce/lib/api/client.js
index 2d77201..12c7ae0 100644
--- a/fashion-ecommerce/lib/api/client.js
+++ b/fashion-ecommerce/lib/api/client.js
@@ -1,5 +1,5 @@
 import logger from "@/lib/logger";
-const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000/api";
+import { API_BASE_URL } from "@/lib/api";
 export class ApiError extends Error {
     constructor(status, message) {
         super(message);
@@ -19,7 +19,7 @@ async function request(endpoint, options = {}) {
     if (token) {
         headers["Authorization"] = `Bearer ${token}`;
     }
-    const url = `${API_BASE_URL}${endpoint}`;
+    const url = `${API_BASE_URL()}${endpoint}`;
     const maxRetries = 2;
     let lastError = null;
     for (let attempt = 0; attempt <= maxRetries; attempt++) {
@@ -121,16 +121,25 @@ async function request(endpoint, options = {}) {
                 throw detailedError;
             }
             let data;
+            let responseText = "";
+            const responseStatus = response.status;
+            const responseContentType = response.headers.get("content-type");
             try {
-                const text = await response.text();
-                if (!text || text.trim().length === 0) {
+                responseText = await response.text();
+                if (!responseText || responseText.trim().length === 0) {
                     return {};
                 }
-                data = JSON.parse(text);
+                data = JSON.parse(responseText);
             }
             catch (parseError) {
                 try {
-                    logger.error("Failed to parse JSON response");
+                    const preview = typeof responseText === "string" ? responseText.slice(0, 200) : "";
+                    logger.error("Failed to parse JSON response", {
+                        url,
+                        status: responseStatus,
+                        contentType: responseContentType || "(missing)",
+                        preview,
+                    });
                 }
                 catch {
                 }
@@ -160,7 +169,7 @@ async function request(endpoint, options = {}) {
                         }
                         catch {
                         }
-                        throw new ApiError(503, `Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL.replace("/api", "")}`);
+                        throw new ApiError(503, `Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL().replace("/api", "")}`);
                     }
                     if (lastError instanceof ApiError) {
                         throw lastError;
@@ -202,7 +211,7 @@ async function request(endpoint, options = {}) {
             throw new ApiError(504, "Request timeout. Please try again.");
         }
         if (lastError instanceof TypeError && (lastError.message === "Failed to fetch" || lastError.message.includes("fetch"))) {
-            throw new ApiError(503, `Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL.replace("/api", "")}`);
+            throw new ApiError(503, `Cannot connect to the server. Please make sure the backend is running on ${API_BASE_URL().replace("/api", "")}`);
         }
         if (lastError instanceof ApiError) {
             throw lastError;
diff --git a/fashion-ecommerce/next.config.mjs b/fashion-ecommerce/next.config.mjs
index 543287c..f7dd4ff 100644
--- a/fashion-ecommerce/next.config.mjs
+++ b/fashion-ecommerce/next.config.mjs
@@ -29,6 +29,19 @@ const nextConfig = {
     
     unoptimized: process.env.CAPACITOR_BUILD === 'true',
   },
+  async rewrites() {
+    const target = process.env.API_PROXY_TARGET;
+    if (!target) {
+      return [];
+    }
+    const normalizedTarget = target.replace(/\/$/, "");
+    return [
+      {
+        source: "/api/:path*",
+        destination: `${normalizedTarget}/api/:path*`,
+      },
+    ];
+  },
   
   poweredByHeader: false,
   compress: true,
@@ -44,7 +57,7 @@ const nextConfig = {
     const fontSrc =
       "font-src 'self' data: https://fonts.gstatic.com";
     const imgSrc =
-      "img-src 'self' data: blob:";
+      "img-src 'self' data: blob: https: http:";
     return [
       {
         source: '/(.*)',
diff --git a/fashion-ecommerce/.env.example b/fashion-ecommerce/.env.example
new file mode 100644
index 0000000..70a79de
--- /dev/null
+++ b/fashion-ecommerce/.env.example
@@ -0,0 +1,13 @@
+# Public API config
+NEXT_PUBLIC_API_BASE_URL=/api
+NEXT_PUBLIC_ANDROID_API_URL=http://10.0.2.2:5000/api
+NEXT_PUBLIC_USE_PROXY=true
+
+# Proxy target for local dev (Next.js rewrite)
+API_PROXY_TARGET=http://localhost:5000
+
+# OAuth
+NEXT_PUBLIC_GOOGLE_CLIENT_ID=
+
+# Backend
+FRONTEND_URL=http://localhost:3000
diff --git a/fashion-ecommerce/lib/api.ts b/fashion-ecommerce/lib/api.ts
new file mode 100644
index 0000000..39bc28b
--- /dev/null
+++ b/fashion-ecommerce/lib/api.ts
@@ -0,0 +1,83 @@
+const RAW_API_BASE_URL =
+  process.env.NEXT_PUBLIC_API_BASE_URL || process.env.NEXT_PUBLIC_API_URL || "";
+const ANDROID_API_URL = process.env.NEXT_PUBLIC_ANDROID_API_URL || "";
+const USE_PROXY = process.env.NEXT_PUBLIC_USE_PROXY === "true";
+const FALLBACK_DEV_WEB_API_URL = "http://localhost:5000/api";
+
+const resolveIsNative = () => {
+  if (typeof window === "undefined") {
+    return false;
+  }
+  const protocol = window.location?.protocol;
+  if (protocol === "capacitor:" || protocol === "ionic:") {
+    return true;
+  }
+  return Boolean(window?.Capacitor?.isNativePlatform?.());
+};
+
+const isHttpsPage = () =>
+  typeof window !== "undefined" && window.location?.protocol === "https:";
+
+const isProduction = () => process.env.NODE_ENV === "production";
+
+const isHttpUrl = (value: string) => value.startsWith("http://");
+
+const ensureHttpsApiUrl = (value: string) => {
+  if (!value) {
+    return value;
+  }
+  if (isHttpUrl(value)) {
+    if (isHttpsPage() || isProduction()) {
+      console.error("[API] Insecure API URL blocked on HTTPS page:", value);
+      return "";
+    }
+    console.warn("[API] Insecure API URL in development:", value);
+  }
+  return value;
+};
+
+export const getApiBaseUrl = () => {
+  if (resolveIsNative()) {
+    return ANDROID_API_URL || RAW_API_BASE_URL || FALLBACK_DEV_WEB_API_URL;
+  }
+
+  if (USE_PROXY) {
+    return "/api";
+  }
+
+  const safeApiUrl = ensureHttpsApiUrl(RAW_API_BASE_URL);
+  if (safeApiUrl) {
+    return safeApiUrl;
+  }
+
+  if (isHttpsPage() || isProduction()) {
+    return "/api";
+  }
+
+  return FALLBACK_DEV_WEB_API_URL;
+};
+
+export const API_BASE_URL = () => getApiBaseUrl();
+
+const CLOUDINARY_HTTP_PREFIX = "http://res.cloudinary.com/";
+const CLOUDINARY_HTTPS_PREFIX = "https://res.cloudinary.com/";
+
+export const sanitizeExternalUrl = (value: string) => {
+  if (!value) {
+    return "";
+  }
+  if (value.startsWith(CLOUDINARY_HTTP_PREFIX)) {
+    if (!isProduction()) {
+      console.warn("[Assets] Upgrading Cloudinary URL to HTTPS:", value);
+    }
+    return CLOUDINARY_HTTPS_PREFIX + value.slice(CLOUDINARY_HTTP_PREFIX.length);
+  }
+  if (value.startsWith("http://")) {
+    if (isHttpsPage() || isProduction()) {
+      console.error("[Assets] Insecure asset URL blocked:", value);
+      return "";
+    }
+    console.warn("[Assets] Insecure asset URL in development:", value);
+  }
+  return value;
+};
